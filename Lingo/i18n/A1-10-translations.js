(() => {
  const data = {
    fallbackLanguage: "de",
    languages: {
      de: { label: "Deutsch", dir: "ltr" },
      en: { label: "English", dir: "ltr" },
      ru: { label: "Русский", dir: "ltr" },
      uk: { label: "Українська", dir: "ltr" },
      es: { label: "Español", dir: "ltr" },
      fr: { label: "Français", dir: "ltr" },
      ar: { label: "العربية", dir: "rtl" },
      tr: { label: "Türkçe", dir: "ltr" },
      it: { label: "Italiano", dir: "ltr" },
      ro: { label: "Română", dir: "ltr" },
      sv: { label: "Svenska", dir: "ltr" },
      pt: { label: "Português", dir: "ltr" },
      ko: { label: "한국어", dir: "ltr" },
      ja: { label: "日本語", dir: "ltr" },
      nl: { label: "Nederlands", dir: "ltr" },
      zh: { label: "中文", dir: "ltr" },
      hr: { label: "Hrvatski", dir: "ltr" },
      hy: { label: "Հայերեն", dir: "ltr" },
    },
    translations: {
      de: {
        "page.title": "Modalverben können & müssen",
        "intro.title": "Modalverben können & müssen",
        "intro.subtitle": "Sprechen über Fähigkeit und Pflicht",
        "intro.description": "Entdecke, wie du mit können Möglichkeiten beschreibst und mit müssen Verpflichtungen ausdrückst. Diese Lektion führt dich Schritt für Schritt durch Formen, Satzstellung und viele Übungen.",
        "intro.level": "Anfänger · A1",
        "intro.duration": "12 Minuten",
        "forms.title": "Konjugation im Präsens",
        "forms.subtitle": "Merke dir die Formen",
        "forms.description": "Präge dir die wichtigsten Personen ein. Achte besonders auf die unregelmäßigen Singularformen.",
        "forms.item1.left": "ich kann · ich muss",
        "forms.item1.right": "kein -e im Singular",
        "forms.item2.left": "du kannst · du musst",
        "forms.item2.right": "Stammwechsel: ö → a / ü → u",
        "forms.item3.left": "er/sie/es kann · muss",
        "forms.item3.right": "gleiche Form wie ich",
        "forms.item4.left": "wir können · wir müssen",
        "forms.item4.right": "Infinitiv + Endung -en",
        "forms.item5.left": "ihr könnt · ihr müsst",
        "forms.item5.right": "Endung -t",
        "forms.item6.left": "sie/Sie können · müssen",
        "forms.item6.right": "wie der Infinitiv",
        "wordorder.title": "Satzstellung mit Modalverb",
        "wordorder.subtitle": "Infinitiv ans Ende!",
        "wordorder.description": "Das Modalverb steht in Position zwei. Das Vollverb bleibt im Infinitiv am Satzende. Verneinungen stehen direkt vor dem Infinitiv.",
        "wordorder.item1.left": "Ich kann heute nicht kommen.",
        "wordorder.item1.right": "kann + kommen",
        "wordorder.item2.left": "Wir müssen den Zug nehmen.",
        "wordorder.item2.right": "müssen + nehmen",
        "wordorder.item3.left": "Musst du lange arbeiten?",
        "wordorder.item3.right": "Frage: Verb zuerst",
        "wordorder.item4.left": "Ich muss nicht warten.",
        "wordorder.item4.right": "nicht + Infinitiv",
        "usage.title": "Wann nutzt du können oder müssen?",
        "usage.subtitle": "Typische Situationen",
        "usage.item1.left": "Fähigkeit",
        "usage.item1.right": "Ich kann gut schwimmen.",
        "usage.item2.left": "Pflicht",
        "usage.item2.right": "Wir müssen früh aufstehen.",
        "usage.item3.left": "Erlaubnis / Angebot",
        "usage.item3.right": "Du kannst später anrufen.",
        "practice.q1.prompt": "Wir ___ morgen früh losfahren.",
        "practice.q1.hint": "Wähle die passende Form.",
        "practice.q1.option1": "müssen",
        "practice.q1.option2": "kann",
        "practice.q1.option3": "könnt",
        "practice.q2.prompt": "Ich ___ heute nicht kochen.",
        "practice.q2.hint": "Wähle die richtige Form von können oder müssen.",
        "practice.q2.option1": "muss",
        "practice.q2.option2": "kann",
        "practice.q2.option3": "müssen",
        "practice.drag1.prompt": "Ordne die Wörter zu einem korrekten Satz.",
        "practice.drag1.hint": "Achte auf Modalverb + Infinitiv.",
        "practice.drag1.word1": "kommen",
        "practice.drag1.word2": "kann",
        "practice.drag1.word3": "Ich",
        "practice.drag1.word4": "nicht",
        "practice.drag1.word5": "heute",
        "practice.q4.prompt": "Könnt ihr morgen kommen? – Ja, wir ___ kommen.",
        "practice.q4.hint": "Ergänze mit können oder müssen.",
        "practice.q4.option1": "können",
        "practice.q4.option2": "müssen",
        "practice.q4.option3": "kann",
        "practice.q5.prompt": "Meine Schwester ___ sehr gut schwimmen.",
        "practice.q5.hint": "Wähle die passende Lösung.",
        "practice.q5.option1": "kann",
        "practice.q5.option2": "muss",
        "practice.q5.option3": "könnt",
        "practice.q6.prompt": "Er ___ noch den Bericht schreiben.",
        "practice.q6.hint": "Entscheide, ob Möglichkeit oder Pflicht passt.",
        "practice.q6.option1": "muss",
        "practice.q6.option2": "kann",
        "practice.q6.option3": "müssen",
        "practice.q7.prompt": "___ du heute einkaufen?",
        "practice.q7.hint": "Beginne den Satz mit dem Verb.",
        "practice.q7.option1": "Kannst",
        "practice.q7.option2": "Musst",
        "practice.q7.option3": "Können",
        "practice.drag2.prompt": "Setze den Satz zusammen.",
        "practice.drag2.hint": "Alle Wörter müssen genutzt werden.",
        "practice.drag2.word1": "Wir",
        "practice.drag2.word2": "müssen",
        "practice.drag2.word3": "heute",
        "practice.drag2.word4": "früh",
        "practice.drag2.word5": "aufstehen",
        "practice.q9.prompt": "Sie ___ heute länger bleiben.",
        "practice.q9.hint": "Drücke Pflicht aus.",
        "practice.q9.option1": "muss",
        "practice.q9.option2": "müssen",
        "practice.q9.option3": "kann",
        "practice.q10.prompt": "Ich ___ leider nicht mitkommen.",
        "practice.q10.hint": "Sage, dass etwas nicht möglich ist.",
        "practice.q10.option1": "kann",
        "practice.q10.option2": "muss",
        "practice.q10.option3": "können",
        "tips.title": "Merksätze",
        "tips.intro": "Halte dir diese Strategien vor Augen:",
        "tips.item1.left": "Übe Lautstärke und Betonung.",
        "tips.item1.right": "Sprich können/müssen immer mit dem Vollverb.",
        "tips.item2.left": "Achte auf nicht.",
        "tips.item2.right": "müssen nicht = keine Pflicht, nicht müssen ≠ Verbot.",
        "tips.item3.left": "Notiere feste Phrasen.",
        "tips.item3.right": "Ich kann leider nicht / Wir müssen los.",
        "tips.outro": "Wechsle zwischen positiven und negativen Beispielen, damit die Bedeutung klar bleibt.",
        "label.lesson": "Lektion",
        "label.practice": "Übung",
        "label.grammar tip": "Grammatik-Tipp",
        "button.start": "Lektion starten",
        "button.next": "Weiter",
        "button.check": "Prüfen",
        "button.finish": "Fertig",
        "feedback.default": "",
        "feedback.selectAnswer": "Bitte wähle eine Antwort, bevor du prüfst.",
        "feedback.correctMultipleChoice": "✅ Sehr gut!",
        "feedback.correctDragDrop": "✅ Gut gemacht!",
        "feedback.incorrect": "❌ Nicht richtig!",
        "feedback.correctAnswerLabel": "Korrekte Antwort:",
      },
      en: {
        "page.title": "Modal verbs können & müssen",
        "intro.title": "Modal verbs können & müssen",
        "intro.subtitle": "Talk about ability and obligation",
        "intro.description": "Discover how to describe possibilities with können and obligations with müssen. This lesson guides you through conjugation, word order, and plenty of practice.",
        "intro.level": "Beginner · A1",
        "intro.duration": "12 minutes",
        "forms.title": "Conjugation in the present",
        "forms.subtitle": "Memorize the forms",
        "forms.description": "Focus on the most common persons. Pay attention to the irregular singular forms.",
        "forms.item1.left": "ich kann · ich muss",
        "forms.item1.right": "no -e ending in singular",
        "forms.item2.left": "du kannst · du musst",
        "forms.item2.right": "stem change: ö → a / ü → u",
        "forms.item3.left": "er/sie/es kann · muss",
        "forms.item3.right": "same form as ich",
        "forms.item4.left": "wir können · wir müssen",
        "forms.item4.right": "infinitive + ending -en",
        "forms.item5.left": "ihr könnt · ihr müsst",
        "forms.item5.right": "ending -t",
        "forms.item6.left": "sie/Sie können · müssen",
        "forms.item6.right": "same as infinitive",
        "wordorder.title": "Word order with modal verbs",
        "wordorder.subtitle": "Infinitive to the end!",
        "wordorder.description": "The modal verb stands in position two. The main verb stays in the infinitive at the end. Negation goes right before the infinitive.",
        "wordorder.item1.left": "Ich kann heute nicht kommen.",
        "wordorder.item1.right": "kann + kommen",
        "wordorder.item2.left": "Wir müssen den Zug nehmen.",
        "wordorder.item2.right": "müssen + nehmen",
        "wordorder.item3.left": "Musst du lange arbeiten?",
        "wordorder.item3.right": "Question: verb comes first",
        "wordorder.item4.left": "Ich muss nicht warten.",
        "wordorder.item4.right": "nicht + infinitive",
        "usage.title": "When do you use können or müssen?",
        "usage.subtitle": "Typical situations",
        "usage.item1.left": "Ability",
        "usage.item1.right": "Ich kann gut schwimmen.",
        "usage.item2.left": "Obligation",
        "usage.item2.right": "Wir müssen früh aufstehen.",
        "usage.item3.left": "Permission / offer",
        "usage.item3.right": "Du kannst später anrufen.",
        "practice.q1.prompt": "Wir ___ morgen früh losfahren.",
        "practice.q1.hint": "Choose the correct form.",
        "practice.q1.option1": "müssen",
        "practice.q1.option2": "kann",
        "practice.q1.option3": "könnt",
        "practice.q2.prompt": "Ich ___ heute nicht kochen.",
        "practice.q2.hint": "Pick the right form of können or müssen.",
        "practice.q2.option1": "muss",
        "practice.q2.option2": "kann",
        "practice.q2.option3": "müssen",
        "practice.drag1.prompt": "Arrange the words into a correct sentence.",
        "practice.drag1.hint": "Remember: modal verb + infinitive.",
        "practice.drag1.word1": "kommen",
        "practice.drag1.word2": "kann",
        "practice.drag1.word3": "Ich",
        "practice.drag1.word4": "nicht",
        "practice.drag1.word5": "heute",
        "practice.q4.prompt": "Könnt ihr morgen kommen? – Ja, wir ___ kommen.",
        "practice.q4.hint": "Fill in with können or müssen.",
        "practice.q4.option1": "können",
        "practice.q4.option2": "müssen",
        "practice.q4.option3": "kann",
        "practice.q5.prompt": "Meine Schwester ___ sehr gut schwimmen.",
        "practice.q5.hint": "Choose the best option.",
        "practice.q5.option1": "kann",
        "practice.q5.option2": "muss",
        "practice.q5.option3": "könnt",
        "practice.q6.prompt": "Er ___ noch den Bericht schreiben.",
        "practice.q6.hint": "Decide whether ability or obligation fits.",
        "practice.q6.option1": "muss",
        "practice.q6.option2": "kann",
        "practice.q6.option3": "müssen",
        "practice.q7.prompt": "___ du heute einkaufen?",
        "practice.q7.hint": "Start the sentence with the verb.",
        "practice.q7.option1": "Kannst",
        "practice.q7.option2": "Musst",
        "practice.q7.option3": "Können",
        "practice.drag2.prompt": "Assemble the sentence.",
        "practice.drag2.hint": "Use all words exactly once.",
        "practice.drag2.word1": "Wir",
        "practice.drag2.word2": "müssen",
        "practice.drag2.word3": "heute",
        "practice.drag2.word4": "früh",
        "practice.drag2.word5": "aufstehen",
        "practice.q9.prompt": "Sie ___ heute länger bleiben.",
        "practice.q9.hint": "Express an obligation.",
        "practice.q9.option1": "muss",
        "practice.q9.option2": "müssen",
        "practice.q9.option3": "kann",
        "practice.q10.prompt": "Ich ___ leider nicht mitkommen.",
        "practice.q10.hint": "Say that something is not possible.",
        "practice.q10.option1": "kann",
        "practice.q10.option2": "muss",
        "practice.q10.option3": "können",
        "tips.title": "Memory tips",
        "tips.intro": "Keep these strategies in mind:",
        "tips.item1.left": "Practice stress and emphasis.",
        "tips.item1.right": "Always say können/müssen together with the main verb.",
        "tips.item2.left": "Watch the word nicht.",
        "tips.item2.right": "müssen nicht = no obligation, nicht müssen ≠ prohibition.",
        "tips.item3.left": "Note fixed phrases.",
        "tips.item3.right": "Ich kann leider nicht / Wir müssen los.",
        "tips.outro": "Alternate between positive and negative examples so the meaning stays clear.",
        "label.lesson": "Lesson",
        "label.practice": "Practice",
        "label.grammar tip": "Grammar tip",
        "button.start": "Start lesson",
        "button.next": "Next",
        "button.check": "Check",
        "button.finish": "Finish",
        "feedback.default": "",
        "feedback.selectAnswer": "Please select an answer before checking.",
        "feedback.correctMultipleChoice": "✅ Great job!",
        "feedback.correctDragDrop": "✅ Well done!",
        "feedback.incorrect": "❌ Not quite!",
        "feedback.correctAnswerLabel": "Correct answer:",
      },
    },
  };

  [
    "ru",
    "uk",
    "es",
    "fr",
    "ar",
    "tr",
    "it",
    "ro",
    "sv",
    "pt",
    "ko",
    "ja",
    "nl",
    "zh",
    "hr",
    "hy",
  ].forEach((code) => {
    if (!data.translations[code]) {
      data.translations[code] = data.translations[data.fallbackLanguage];
    }
  });

  const params = new URLSearchParams(window.location.search);
  const requested = (params.get("ln") || params.get("lang") || data.fallbackLanguage || "de").toLowerCase();
  const language = data.translations[requested]
    ? requested
    : data.translations[data.fallbackLanguage]
      ? data.fallbackLanguage
      : Object.keys(data.translations)[0];
  const dir = data.languages[language]?.dir || "ltr";
  const dictionary = data.translations[language] || {};
  const translator = (key, fallback = "") => dictionary[key] || fallback;
  window.lessonLocalization = {
    language,
    dir,
    translate: translator,
    availableLanguages: Object.keys(data.translations),
  };
  document.documentElement.lang = language;
  document.documentElement.dir = dir;
  if (document.body) {
    document.body.dir = dir;
  }
  const pageTitle = translator("page.title");
  if (pageTitle) {
    document.title = pageTitle;
  }
  document.querySelectorAll("[data-i18n]").forEach((node) => {
    const key = node.getAttribute("data-i18n");
    if (!key) return;
    const value = translator(key, node.textContent);
    if (typeof value === "string") {
      node.textContent = value;
    }
  });
})();
