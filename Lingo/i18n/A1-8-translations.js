(() => {
  const duplicate = (input) => JSON.parse(JSON.stringify(input));

  const languages = {
    de: { label: "Deutsch", dir: "ltr" },
    en: { label: "English", dir: "ltr" },
    ru: { label: "Русский", dir: "ltr" },
    uk: { label: "Українська", dir: "ltr" },
    es: { label: "Español", dir: "ltr" },
    fr: { label: "Français", dir: "ltr" },
    ar: { label: "العربية", dir: "rtl" },
    tr: { label: "Türkçe", dir: "ltr" },
    it: { label: "Italiano", dir: "ltr" },
    ro: { label: "Română", dir: "ltr" },
    sv: { label: "Svenska", dir: "ltr" },
    pt: { label: "Português", dir: "ltr" },
    ko: { label: "한국어", dir: "ltr" },
    ja: { label: "日本語", dir: "ltr" },
    nl: { label: "Nederlands", dir: "ltr" },
    zh: { label: "中文", dir: "ltr" },
    hr: { label: "Hrvatski", dir: "ltr" },
    hy: { label: "Հայերեն", dir: "ltr" },
  };

  const german = {
    "page.title": "Regelmäßige Verben im Präsens",
    "label.lesson": "Lektion",
    "label.practice": "Übung",
    "label.grammar": "Grammatik",
    "label.wrapup": "Abschluss",
    "button.start": "Lektion starten",
    "button.next": "Weiter",
    "button.check": "Prüfen",
    "button.finish": "Fertig",
    "feedback.default": "",
    "feedback.selectAnswer": "Bitte wähle eine Antwort, bevor du prüfst.",
    "feedback.correctMultipleChoice": "✅ Sehr gut!",
    "feedback.correctDragDrop": "✅ Gut gemacht!",
    "feedback.incorrect": "❌ Nicht richtig!",
    "feedback.correctAnswerLabel": "Korrekte Antwort:",
    "intro.title": "Regelmäßige Verben im Präsens",
    "intro.subtitle": "Endungen sicher anwenden",
    "intro.description": "Lerne, wie du Tätigkeiten mit den Endungen -e, -st, -t und -en beschreibst und bilde sofort eigene Sätze.",
    "intro.level": "Anfänger · A1",
    "intro.duration": "8 Minuten",
    "pattern.title": "Konjugationsmuster",
    "pattern.subtitle": "So funktioniert es",
    "pattern.description": "Stamm plus Endung:",
    "pattern.item1.left": "ich lerne",
    "pattern.item1.right": "Endung: -e",
    "pattern.item2.left": "du lernst",
    "pattern.item2.right": "Endung: -st",
    "pattern.item3.left": "er/sie/es lernt",
    "pattern.item3.right": "Endung: -t",
    "pattern.item4.left": "wir lernen",
    "pattern.item4.right": "Endung: -en",
    "pattern.item5.left": "ihr lernt",
    "pattern.item5.right": "Endung: -t",
    "pattern.item6.left": "sie/Sie lernen",
    "pattern.item6.right": "Endung: -en",
    "verbs.title": "Beliebte regelmäßige Verben",
    "verbs.description": "Merke dir diese Verben für den Alltag:",
    "verbs.item1.left": "arbeiten",
    "verbs.item1.right": "am Computer, im Büro",
    "verbs.item2.left": "wohnen",
    "verbs.item2.right": "in der Stadt, auf dem Land",
    "verbs.item3.left": "spielen",
    "verbs.item3.right": "mit Freunden, mit Kindern",
    "verbs.item4.left": "kochen",
    "verbs.item4.right": "Abendessen, Suppe",
    "verbs.item5.left": "lernen",
    "verbs.item5.right": "Deutsch, neue Wörter",
    "examples.title": "Beispielsätze",
    "examples.subtitle": "Spreche über Routinen",
    "examples.description": "Nutze die Verben in vollständigen Sätzen:",
    "examples.item1.left": "Ich mache jeden Morgen Kaffee.",
    "examples.item2.left": "Du arbeitest heute im Büro.",
    "examples.item3.left": "Wir besuchen am Wochenende Freunde.",
    "examples.item4.left": "Ihr spielt abends Karten.",
    "practice.q1.prompt": "Ich ___ jeden Abend Deutsch.",
    "practice.q1.hint": "Wähle die richtige Form.",
    "practice.q1.option1": "lerne",
    "practice.q1.option2": "lernst",
    "practice.q1.option3": "lernt",
    "practice.q2.prompt": "Du ___ in Berlin.",
    "practice.q2.hint": "Wähle die richtige Form.",
    "practice.q2.option1": "wohne",
    "practice.q2.option2": "wohnst",
    "practice.q2.option3": "wohnt",
    "practice.drag1.prompt": "Ordne die Wörter zu einem Satz.",
    "practice.drag1.hint": "Setze alles in die richtige Reihenfolge.",
    "practice.drag1.word1": "spielen",
    "practice.drag1.word2": "am",
    "practice.drag1.word3": "Wir",
    "practice.drag1.word4": "Abend",
    "practice.drag1.word5": "Karten",
    "practice.q3.prompt": "Er ___ jeden Tag Kaffee.",
    "practice.q3.hint": "Wähle die richtige Form.",
    "practice.q3.option1": "trinke",
    "practice.q3.option2": "trinkst",
    "practice.q3.option3": "trinkt",
    "practice.q4.prompt": "Wir ___ das Abendessen zusammen.",
    "practice.q4.hint": "Wähle die richtige Form.",
    "practice.q4.option1": "koche",
    "practice.q4.option2": "kochst",
    "practice.q4.option3": "kochen",
    "practice.q5.prompt": "Ihr ___ sehr schnell.",
    "practice.q5.hint": "Wähle die richtige Form.",
    "practice.q5.option1": "lauft",
    "practice.q5.option2": "laufst",
    "practice.q5.option3": "laufen",
    "practice.drag2.prompt": "Baue den Satz aus den Bausteinen.",
    "practice.drag2.hint": "Achte auf Groß- und Kleinschreibung.",
    "practice.drag2.word1": "am",
    "practice.drag2.word2": "Sie",
    "practice.drag2.word3": "Eltern",
    "practice.drag2.word4": "Wochenende",
    "practice.drag2.word5": "besuchen",
    "practice.drag2.word6": "ihre",
    "practice.q6.prompt": "Sie ___ jeden Samstag ihre Großeltern.",
    "practice.q6.hint": "Wähle die richtige Form.",
    "practice.q6.option1": "besuche",
    "practice.q6.option2": "besuchen",
    "practice.q6.option3": "besucht",
    "grammar.title": "Grammatik-Hinweis",
    "grammar.description": "Beachte Besonderheiten bei regelmäßigen Verben:",
    "grammar.item1.left": "Stämme mit -t/-d",
    "grammar.item1.right": "füge ein -e- ein: du arbeitest, er wartet.",
    "grammar.item2.left": "Verben auf -eln/-ern",
    "grammar.item2.right": "ich sammle → wir sammeln, ich wandere → wir wandern.",
    "grammar.item3.left": "Klar sprechen",
    "grammar.item3.right": "betone jede Endung: lernen, wartest.",
    "grammar.outro": "Mit Übung klingen deine Sätze automatisch flüssig.",
    "wrapup.title": "Dein Lernplan",
    "wrapup.description": "Wiederhole die Verben laut, schreibe fünf eigene Sätze und nutze sie noch heute im Gespräch.",
    "wrapup.item1.left": "1. Lesen",
    "wrapup.item1.right": "Schaue dir die Beispiele erneut an.",
    "wrapup.item2.left": "2. Sprechen",
    "wrapup.item2.right": "Sprich jeden Satz laut aus.",
    "wrapup.item3.left": "3. Schreiben",
    "wrapup.item3.right": "Notiere neue Routinen mit lernen, arbeiten, spielen.",
  };

  const english = {
    "page.title": "Regular verbs in the present tense",
    "label.lesson": "Lesson",
    "label.practice": "Practice",
    "label.grammar": "Grammar",
    "label.wrapup": "Wrap-up",
    "button.start": "Start lesson",
    "button.next": "Next",
    "button.check": "Check",
    "button.finish": "Finish",
    "feedback.default": "",
    "feedback.selectAnswer": "Please choose an answer before checking.",
    "feedback.correctMultipleChoice": "✅ Great job!",
    "feedback.correctDragDrop": "✅ Well done!",
    "feedback.incorrect": "❌ Not quite right!",
    "feedback.correctAnswerLabel": "Correct answer:",
    "intro.title": "Regular verbs in the present tense",
    "intro.subtitle": "Master the endings",
    "intro.description": "Learn how to describe actions with the endings -e, -st, -t, and -en and build your own sentences right away.",
    "intro.level": "Beginner · A1",
    "intro.duration": "8 minutes",
    "pattern.title": "Conjugation pattern",
    "pattern.subtitle": "How it works",
    "pattern.description": "Stem plus ending:",
    "pattern.item1.left": "ich lerne",
    "pattern.item1.right": "Ending: -e",
    "pattern.item2.left": "du lernst",
    "pattern.item2.right": "Ending: -st",
    "pattern.item3.left": "er/sie/es lernt",
    "pattern.item3.right": "Ending: -t",
    "pattern.item4.left": "wir lernen",
    "pattern.item4.right": "Ending: -en",
    "pattern.item5.left": "ihr lernt",
    "pattern.item5.right": "Ending: -t",
    "pattern.item6.left": "sie/Sie lernen",
    "pattern.item6.right": "Ending: -en",
    "verbs.title": "Common regular verbs",
    "verbs.description": "Remember these verbs for everyday situations:",
    "verbs.item1.left": "arbeiten",
    "verbs.item1.right": "at the computer, in the office",
    "verbs.item2.left": "wohnen",
    "verbs.item2.right": "in the city, in the countryside",
    "verbs.item3.left": "spielen",
    "verbs.item3.right": "with friends, with children",
    "verbs.item4.left": "kochen",
    "verbs.item4.right": "dinner, soup",
    "verbs.item5.left": "lernen",
    "verbs.item5.right": "German, new words",
    "examples.title": "Example sentences",
    "examples.subtitle": "Talk about routines",
    "examples.description": "Use the verbs in full sentences:",
    "examples.item1.left": "I make coffee every morning.",
    "examples.item2.left": "You are working in the office today.",
    "examples.item3.left": "We visit friends on the weekend.",
    "examples.item4.left": "You all play cards in the evening.",
    "practice.q1.prompt": "Ich ___ jeden Abend Deutsch.",
    "practice.q1.hint": "Choose the correct form.",
    "practice.q1.option1": "lerne",
    "practice.q1.option2": "lernst",
    "practice.q1.option3": "lernt",
    "practice.q2.prompt": "Du ___ in Berlin.",
    "practice.q2.hint": "Choose the correct form.",
    "practice.q2.option1": "wohne",
    "practice.q2.option2": "wohnst",
    "practice.q2.option3": "wohnt",
    "practice.drag1.prompt": "Arrange the words to form a sentence.",
    "practice.drag1.hint": "Put everything in the correct order.",
    "practice.drag1.word1": "spielen",
    "practice.drag1.word2": "am",
    "practice.drag1.word3": "Wir",
    "practice.drag1.word4": "Abend",
    "practice.drag1.word5": "Karten",
    "practice.q3.prompt": "Er ___ jeden Tag Kaffee.",
    "practice.q3.hint": "Choose the correct form.",
    "practice.q3.option1": "trinke",
    "practice.q3.option2": "trinkst",
    "practice.q3.option3": "trinkt",
    "practice.q4.prompt": "Wir ___ das Abendessen zusammen.",
    "practice.q4.hint": "Choose the correct form.",
    "practice.q4.option1": "koche",
    "practice.q4.option2": "kochst",
    "practice.q4.option3": "kochen",
    "practice.q5.prompt": "Ihr ___ sehr schnell.",
    "practice.q5.hint": "Choose the correct form.",
    "practice.q5.option1": "lauft",
    "practice.q5.option2": "laufst",
    "practice.q5.option3": "laufen",
    "practice.drag2.prompt": "Build the sentence from the blocks.",
    "practice.drag2.hint": "Pay attention to capitalization.",
    "practice.drag2.word1": "am",
    "practice.drag2.word2": "Sie",
    "practice.drag2.word3": "Eltern",
    "practice.drag2.word4": "Wochenende",
    "practice.drag2.word5": "besuchen",
    "practice.drag2.word6": "ihre",
    "practice.q6.prompt": "Sie ___ jeden Samstag ihre Großeltern.",
    "practice.q6.hint": "Choose the correct form.",
    "practice.q6.option1": "besuche",
    "practice.q6.option2": "besuchen",
    "practice.q6.option3": "besucht",
    "grammar.title": "Grammar tip",
    "grammar.description": "Watch out for these special cases with regular verbs:",
    "grammar.item1.left": "Stems ending in -t/-d",
    "grammar.item1.right": "Add -e-: du arbeitest, er wartet.",
    "grammar.item2.left": "Verbs ending in -eln/-ern",
    "grammar.item2.right": "ich sammle → wir sammeln, ich wandere → wir wandern.",
    "grammar.item3.left": "Speak clearly",
    "grammar.item3.right": "Emphasize every ending: lernen, wartest.",
    "grammar.outro": "With practice your sentences will automatically sound fluent.",
    "wrapup.title": "Your study plan",
    "wrapup.description": "Repeat the verbs out loud, write five sentences of your own, and use them in conversation today.",
    "wrapup.item1.left": "1. Read",
    "wrapup.item1.right": "Review the example sentences.",
    "wrapup.item2.left": "2. Speak",
    "wrapup.item2.right": "Say each sentence out loud.",
    "wrapup.item3.left": "3. Write",
    "wrapup.item3.right": "Note new routines with lernen, arbeiten, spielen.",
  };

  const data = {
    fallbackLanguage: "de",
    languages,
    translations: {
      de: german,
      en: english,
    },
  };

  ["ru", "uk", "es", "fr", "ar", "tr", "it", "ro", "sv", "pt", "ko", "ja", "nl", "zh", "hr", "hy"].forEach((lang) => {
    data.translations[lang] = duplicate(english);
  });

  const params = new URLSearchParams(window.location.search);
  const requested = (
    params.get("ln") ||
    params.get("lang") ||
    data.fallbackLanguage ||
    "de"
  ).toLowerCase();
  const language = data.translations[requested]
    ? requested
    : data.translations[data.fallbackLanguage]
    ? data.fallbackLanguage
    : Object.keys(data.translations)[0];
  const dir = data.languages[language]?.dir || "ltr";
  const dictionary = data.translations[language] || {};
  const translator = (key, fallback = "") => dictionary[key] || fallback;

  window.lessonLocalization = {
    language,
    dir,
    translate: translator,
    availableLanguages: Object.keys(data.translations),
  };

  document.documentElement.lang = language;
  document.documentElement.dir = dir;
  if (document.body) {
    document.body.dir = dir;
  }

  const pageTitle = translator("page.title");
  if (pageTitle) {
    document.title = pageTitle;
  }

  document.querySelectorAll("[data-i18n]").forEach((node) => {
    const key = node.getAttribute("data-i18n");
    if (!key) return;
    const value = translator(key, node.textContent);
    if (typeof value === "string") {
      node.textContent = value;
    }
  });
})();
